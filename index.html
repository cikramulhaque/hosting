<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Bottle Rewards Login</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{margin:0;background:#0d0d0d;color:white;font-family:Arial;height:100vh;display:flex;justify-content:center;align-items:center;}
.container{width:90%;max-width:400px;background:#121212;padding:25px;border-radius:10px;position:relative;}
h2{text-align:center;margin-bottom:20px;}
input{width:100%;padding:10px;margin:8px 0;border-radius:5px;border:none;}
button{width:100%;padding:10px;margin-top:10px;border-radius:5px;border:none;background:#00c853;color:white;font-size:16px;}
.linkBtn{color:#00c8ff;text-align:center;margin-top:10px;cursor:pointer;}
.menu{position:absolute;top:10px;right:10px;cursor:pointer;font-size:22px;}
.dropdown{position:absolute;right:10px;top:35px;background:#1c1c1c;padding:10px;border-radius:5px;display:none;}
.dropdown div{padding:5px 10px;cursor:pointer;}
.dropdown div:hover{background:#333;}
#storeLogin{display:none;}
#registerBox{display:none;}
.toggle-eye{position:absolute;right:30px;margin-top:-34px;cursor:pointer;}
.message{text-align:center;margin-top:10px;}
.error{color:#ff4b4b;}
.success{color:#00ff6a;}
</style>
</head>

<body>

<div class="container">

  <div class="menu" onclick="toggleMenu()">‚ãÆ</div>

  <div class="dropdown" id="menuDrop">
    <div onclick="showCustomer()">Customer Login</div>
    <div onclick="showStore()">Store Login</div>
  </div>

  <h2 id="title">Customer Login</h2>

  <!-- CUSTOMER LOGIN -->
  <div id="customerLogin">
    <input id="cemail" type="email" placeholder="Customer Email">
    <input id="cpass" type="password" placeholder="Password">
    <span class="toggle-eye" onclick="toggle('cpass')">üëÅ</span>
    <button onclick="customerLogin()">Login</button>

    <div class="linkBtn" onclick="showRegister()">Create Account</div>
    <div class="linkBtn" onclick="forgotPassword()">Forgot Password?</div>
  </div>

  <!-- REGISTER -->
  <div id="registerBox">
    <input id="remail" type="email" placeholder="Customer Email">

    <div style="position:relative;">
      <input id="rpass" type="password" placeholder="Password">
      <span class="toggle-eye" onclick="toggle('rpass')">üëÅ</span>
    </div>

    <div style="position:relative;">
      <input id="rcpass" type="password" placeholder="Confirm Password">
      <span class="toggle-eye" onclick="toggle('rcpass')">üëÅ</span>
    </div>

    <button onclick="registerUser()">Register</button>
    <div class="linkBtn" onclick="showCustomer()">Back to Login</div>
  </div>

  <!-- STORE LOGIN -->
  <div id="storeLogin">
    <input id="semail" type="email" placeholder="Store Email">
    <input id="spass" type="password" placeholder="Password">
    <span class="toggle-eye" onclick="toggle('spass')">üëÅ</span>
    <button onclick="storeLogin()">Login</button>
  </div>

  <div class="message" id="msg"></div>

</div>


<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { 
  getAuth, 
  signInWithEmailAndPassword, 
  createUserWithEmailAndPassword,
  sendPasswordResetEmail,
  signOut
} from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

import { 
  getFirestore, 
  setDoc, 
  doc, 
  getDoc 
} from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyA7Tck7VFnldXnKj9fMpPc9bSWqgVQA8jU",
  authDomain: "bottlereward.firebaseapp.com",
  projectId: "bottlereward",
  storageBucket: "bottlereward.firebasestorage.app",
  messagingSenderId: "842823471278",
  appId: "1:842823471278:web:a7bbbb0291e581dcc71d3f"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth();
const db = getFirestore();
const msg = document.getElementById("msg");


// ---------- REGISTER ----------
window.registerUser = function(){
 const email=document.getElementById("remail").value;
 const pass=document.getElementById("rpass").value;
 const cpass=document.getElementById("rcpass").value;

 if(pass!==cpass){
   msg.innerHTML="<span class='error'>Passwords do not match ‚ùå</span>";
   return;
 }

 msg.innerHTML="Creating Account...";
 createUserWithEmailAndPassword(auth,email,pass)
 .then(async (u)=>{
  await setDoc(doc(db,"users",u.user.email),{
    email:u.user.email,
    points:0,
    bottles:0,
    history:[]
  });
  msg.innerHTML="<span class='success'>Account Created ‚úî Login Now</span>";
  showCustomer();
 })
 .catch(e=>msg.innerHTML=e.message);
}


// ---------- CUSTOMER LOGIN ----------
window.customerLogin = function(){
  msg.innerHTML="Processing...";
  signInWithEmailAndPassword(auth,
    document.getElementById("cemail").value,
    document.getElementById("cpass").value)
  .then(()=>{
    msg.innerHTML="<span class='success'>Login Success ‚úî Redirecting‚Ä¶</span>";
    setTimeout(()=>location="transfer.html",1200);
  })
  .catch(e=>msg.innerHTML=e.message);
}


// ---------- FORGOT PASSWORD (FULLY WORKING) ----------
window.forgotPassword = function(){
 const email=document.getElementById("cemail").value;

 msg.innerHTML="Processing reset request...";

 if(!email){
   msg.innerHTML="<span class='error'>Enter your email first ‚ùå</span>";
   return;
 }

 sendPasswordResetEmail(auth,email)
 .then(()=>{
   msg.innerHTML="<span class='success'>Reset email sent ‚úî Check inbox</span>";
 })
 .catch(e=>{
   msg.innerHTML=e.message;
 });
}


// ---------- STORE LOGIN SECURE ----------
window.storeLogin = async function(){
 msg.innerHTML="Checking Store Access...";
 let email=document.getElementById("semail").value;
 let pass=document.getElementById("spass").value;

 try{
   await signInWithEmailAndPassword(auth,email,pass);

   let storeRef = doc(db,"stores",email);
   let snap = await getDoc(storeRef);

   if(!snap.exists()){
     msg.innerHTML="‚ùå Not Authorized as Store";
     await signOut(auth);
     return;
   }

   msg.innerHTML="<span class='success'>Store Verified ‚úî Redirecting...</span>";
   setTimeout(()=>location="store.html",1200);
 }
 catch(e){
  msg.innerHTML=e.message;
 }
}

</script>

<script>
function toggleMenu(){
 const m=document.getElementById("menuDrop");
 m.style.display = m.style.display==="block"?"none":"block";
}
function closeMenu(){
 document.getElementById("menuDrop").style.display="none";
}
function showCustomer(){
 closeMenu();
 document.getElementById("customerLogin").style.display="block";
 document.getElementById("storeLogin").style.display="none";
 document.getElementById("registerBox").style.display="none";
 document.getElementById("title").innerText="Customer Login";
}
function showStore(){
 closeMenu();
 document.getElementById("customerLogin").style.display="none";
 document.getElementById("storeLogin").style.display="block";
 document.getElementById("registerBox").style.display="none";
 document.getElementById("title").innerText="Store Login";
}
function showRegister(){
 closeMenu();
 document.getElementById("customerLogin").style.display="none";
 document.getElementById("storeLogin").style.display="none";
 document.getElementById("registerBox").style.display="block";
 document.getElementById("title").innerText="Register";
}
function toggle(id){
 let f=document.getElementById(id);
 f.type=f.type==="password"?"text":"password";
}
</script>

</body>
</html>
