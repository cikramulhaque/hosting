<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Store Panel</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body{
 background:#0d0d0d;
 color:white;
 font-family:Arial;
 margin:0;
 padding:20px;
}
.container{
 max-width:500px;
 margin:auto;
 background:#121212;
 padding:20px;
 border-radius:10px;
}
.card{
 background:#1d1d1d;
 padding:10px;
 margin:10px 0;
 border-radius:8px;
}
button{
 background:#ff5252;
 width:100%;
 padding:10px;
 border:none;
 border-radius:5px;
 color:white;
 margin-top:10px;
}
</style>
</head>
<body>

<div class="container">
<h2>Store Panel</h2>
<div>Email: <span id="email"></span></div>
<button onclick="logout()">Logout</button>
<h3>Transactions</h3>
<div id="list"></div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyA7Tck7VFnldXnKj9fMpPc9bSWqgVQA8jU",
  authDomain: "bottlereward.firebaseapp.com",
  projectId: "bottlereward",
  storageBucket: "bottlereward.firebasestorage.app",
  messagingSenderId: "842823471278",
  appId: "1:842823471278:web:a7bbbb0291e581dcc71d3f"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth();
const db = getFirestore();

const list=document.getElementById("list");

onAuthStateChanged(auth, async (user)=>{
 if(!user) location="index.html";
 document.getElementById("email").innerText=user.email;

 let ref=doc(db,"stores",user.email);
 let snap=await getDoc(ref);

 if(!snap.exists()){
   list.innerHTML="No transactions yet";
   return;
 }

 let data=snap.data();
 if(!data.transactions || data.transactions.length===0){
  list.innerHTML="No transactions yet";
  return;
 }

 data.transactions.reverse().forEach(t=>{
  let div=document.createElement("div");
  div.className="card";
  div.innerHTML=
   `<b>User:</b> ${t.user}<br>
    <b>Points:</b> ${t.points}<br>
    <b>Time:</b> ${new Date(t.time.seconds? t.time.seconds*1000:t.time).toLocaleString()}`;
  list.appendChild(div);
 });
});

window.logout=function(){
 signOut(auth).then(()=>location="index.html");
}
</script>
</body>
</html>
